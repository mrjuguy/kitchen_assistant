---
description: Spawns a sub-agent to audit recent changes and generate a permanent review artifact.
---

# Code Review Workflow

1. **The Gatekeeper**
   - **Action**: Run `npm run gatekeeper`.
   - **Logic**: 
     - IF this output contains errors or the command fails, **STOP IMMEDIATELY**.
     - Display the errors to the User.
     - Do NOT spawn the child agent.

2. **The Context**
   - **Action**: Run `git diff --stat -p ':(exclude)package-lock.json' ':(exclude)npm-lock.yaml' ':(exclude)*.lock'` to capture the exact changes without noise.
   - **Note**: If the diff is still too large (>500 lines), focus on specific directories (e.g., `git diff ... -- app/ components/`).

3. **The Reviewer**
   - **Action (Antigravity-First)**: For light features or documentation, perform the audit directly against the standards in `.agent/skills/code-review/SKILL.md`.
   - **Action (Delegate)**: For complex structural changes, spawn the `claude` child agent using the `run_command` tool.
   - **Command Config (for delegation)**:
     - Use `-p` for headless mode.
     - **Allowed Tools**: `Bash,Read,Grep,Glob,find_by_name,view_file,write_to_file,replace_file_content`.
     - **Agent**: `qa-bot`.
   - **Prompt**:
     - **Rules**: Content of `.agent/skills/code-review/SKILL.md`.
     - **Diff**: The output from `git diff` in Step 2.
   - **Prompt**:
     > "You are the QA Bot.
     >
     > **AUDIT RULES (Follow Strictly):**
     > [Insert SKILL.md content]
     >
     > **CONTEXT:**
     > The following changes have passed the strict Gatekeeper (TypeScript + ESLint):
     > [Insert Git Diff Content]
     >
     > **TASK:**
     > 1. Read `specs/issue_*.md` (or `specs/active_PRD.md`) to verify requirements.
     > 2. Analyze the provided changes against the Audit Rules.
     > 3. Generate a report in Markdown format.
     > 4. SAVE this report to `specs/reviews/YYYY-MM-DD-[feature_name].md`.
     > 5. Do not ask for permission to write the file, just do it."

4. **Analysis of Result**
   - Wait for the child agent to complete.
   - Read the file generated by the child agent.
   - Output a summary to the user: "Review generated at [path]. Verdict: [PASS/FAIL]."